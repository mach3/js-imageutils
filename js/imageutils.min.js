/*
 * ImageUtils
 * 
 * @version 0.9
 * @license MIT License
 * @author mach3
 * @require jQuery 1.7+
 */
(function(b,c){var a=({type:"ImageUtils",browser:{msie:false,version:null},regex:{extension:/\.(png|jpg|jpeg|gif)$/i},init:function(){var d=navigator.userAgent.match(/MSIE\s([\d\.]+?);/i);this.browser.msie=d!==null;if(this.browser.msie){this.browser.version=parseInt(d[1],10)}return this},_replace:function(e,d){return e.replace(/\{\{(\w+?)\}\}/g,function(g,f){return d[f]||""})},_hasSize:function(d){var e=b(d);return Boolean(e.width()&&e.height())},_getType:function(e){var d=null;switch(true){case /AlphaImageLoader/i.test(b(e).css("filter")):d="ail";break;case e.tagName.toLowerCase()==="img":d="img";break;default:d="block";break}return d},_getImage:function(e){var f,d;f=b(e);d=null;switch(this._getType(e)){case"ail":d=f.css("filter").match(/src=([^,\)]+)/)[1];break;case"img":d=f.prop("src");break;default:d=f.css("background-image").match(/url\("?(.+?)"?\)/)[1];break}return d},_getHoverImage:function(d,e){return this._getImage(d).replace(this.regex.extension,function(f){return e+f})},alphaImage:function(e,d){var f={};if(!this.browser.msie){return}f.self=this;f.opt=b.extend({method:"image",blankImage:"./blank.gif"},d);f.ail="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod={{method}}, src={{path}});";f.setFilter=function(){var i,h,g;i=b(this);h=i.data("alpha-image");if(this.tagName.toLowerCase()==="img"){g=i.prop("src");i.css({width:i.width(),height:i.height()});i.prop("src",h.opt.blankImage)}else{g=i.css("background-image").match(/url\("?(.+?)"?\)/)[1];i.css("background-image","none");i.append(b("<span>").css({position:"absolute",display:"block","background-color":"#fff",width:i.width(),height:i.height(),opacity:0}))}i.css({filter:h.self._replace(h.ail,{method:h.opt.method,path:g})})};e.each(function(){var g=b(this);g.data("alpha-image",f);if(f.self._hasSize(this)){f.setFilter.call(this)}else{b(this).on("load",f.setFilter)}})},swapImage:function(e,d){var f={};f.self=this;f.opt=b.extend({hoverPostfix:"-hover",ignoreClass:"active"},d);f.swap=function(i){var l,h,k,j,g;l=b(this);h=l.data("swap-image");if(l.hasClass(h.opt.ignoreClass)){return}k=i.type.toLowerCase()==="mouseenter";j=k?l.data("hover-image"):l.data("default-image");switch(h.self._getType(this)){case"ail":l.css("filter",l.css("filter").replace(/src=([^,\)\s]+)/,function(){return"src="+j}));break;case"img":l.attr("src",j);break;default:l.css("background-image","url("+j+")");break}};e.each(function(){var g=b(this);g.data("default-image",f.self._getImage(this));g.data("hover-image",f.self._getHoverImage(this,f.opt.hoverPostfix));g.data("swap-image",f);b("<img>").on("load",function(){g.hover(f.swap,f.swap)}).attr("src",g.data("hover-image"))})},blendImage:function(e,d){var f={};f.self=this;f.opt=b.extend({hoverPostfix:"-hover",ignoreClass:"active",durationEnter:100,durationLeave:500},d);f.init=function(){var j,h,i,g;j=b(this);h=j.data("blend-image");i=h.self._getHoverImage(this,h.opt.hoverPostfix);g=b("<span>").css({position:"absolute",display:"block",width:j.width(),height:j.height(),"background-image":"url("+i+")"});if(h.self.browser.msie){h.self.alphaImage(g);g.css("background-image","none")}g.css("opacity",0);if(this.tagName.toLowerCase()==="img"){g.insertBefore(j)}else{j.append(g)}g.data("blend-image",h);g.hover(h.blend,h.blend)};f.blend=function(j){var i,k,g,h;i=b(this).data("blend-image");k=j.type==="mouseenter";g=k?1:0;h=i.opt["duration"+(k?"Enter":"Leave")];b(this).stop().fadeTo(h,g)};e.each(function(){b(this).data("blend-image",f);if(f.self._hasSize(this)){f.init.call(this)}else{b(this).on("load",f.init)}})}}).init();b.fn.extend({alphaImage:function(d){a.alphaImage(this,d);return this},swapImage:function(d){a.swapImage(this,d);return this},blendImage:function(d){a.blendImage(this,d);return this}})}(jQuery));