/*!
 * ImageUtils
 * 
 * @version 0.9
 * @license MIT License
 * @author mach3
 * @require jQuery 1.7+
 */
(function(b,c){var a=({type:"ImageUtils",browser:{msie:false,version:0,ail:false},regex:{extension:/\.(png|jpg|jpeg|gif)$/i},init:function(){var d=navigator.userAgent.match(/MSIE\s([\d\.]+?);/i);this.browser.msie=d!==null;if(this.browser.msie){this.browser.version=parseInt(d[1],10);if(this.browser.version<9){this.browser.ail=true}}return this},_replace:function(e,d){return e.replace(/\{\{(\w+?)\}\}/g,function(g,f){return d[f]||""})},_hasSize:function(d){var e=b(d);return Boolean(e.width()&&e.height())},_getType:function(e){var d=null;switch(true){case /AlphaImageLoader/i.test(b(e).css("filter")):d="ail";break;case e.tagName.toLowerCase()==="img":d="img";break;default:d="block";break}return d},_getImage:function(e){var f,d;f=b(e);d=null;switch(this._getType(e)){case"ail":d=f.css("filter").match(/src=([^,\)]+)/)[1];break;case"img":d=f.prop("src");break;default:d=f.css("background-image").match(/url\("?(.+?)"?\)/)[1];break}return d},_getHoverImage:function(d,e){return this._getImage(d).replace(this.regex.extension,function(f){return e+f})},alphaImage:function(e,d){var f={};if(!this.browser.ail){return}f.self=this;f.opt=b.extend({method:"image",blankImage:"./blank.gif"},d);f.ail="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod={{method}}, src={{path}});";f.setFilter=function(){var h,g;h=b(this);if(this.tagName.toLowerCase()==="img"){g=h.prop("src");h.css({width:h.width(),height:h.height()});h.prop("src",f.opt.blankImage)}else{g=h.css("background-image").match(/url\("?(.+?)"?\)/)[1];h.css("background-image","none");h.append(b("<span>").css({position:"absolute",display:"block","background-color":"#fff",width:h.width(),height:h.height(),opacity:0}))}h.css({filter:f.self._replace(f.ail,{method:f.opt.method,path:g})})};e.each(function(){var g=b(this);if(f.self._hasSize(this)){f.setFilter.call(this)}else{b(this).on("load",f.setFilter)}});return e},swapImage:function(e,d){var f={};f.self=this;f.opt=b.extend({hoverPostfix:"-hover",ignoreClass:"active"},d);f.swap=function(h){var k,j,i,g;k=b(this);if(k.hasClass(f.opt.ignoreClass)){return}j=h.type.toLowerCase()==="mouseenter";i=j?k.data("hover-image"):k.data("default-image");switch(f.self._getType(this)){case"ail":k.css("filter",k.css("filter").replace(/src=([^,\)\s]+)/,function(){return"src="+i}));break;case"img":k.attr("src",i);break;default:k.css("background-image","url("+i+")");break}};e.each(function(){var g=b(this);g.data("default-image",f.self._getImage(this));g.data("hover-image",f.self._getHoverImage(this,f.opt.hoverPostfix));b("<img>").on("load",function(){g.hover(f.swap,f.swap)}).attr("src",g.data("hover-image"))});return e},blendImage:function(e,d){var f={};f.self=this;f.opt=b.extend({hoverPostfix:"-hover",ignoreClass:"active",durationEnter:100,durationLeave:500},d);f.init=function(){var i,h,g;i=b(this);h=f.self._getHoverImage(this,f.opt.hoverPostfix);g=b("<span>").css({position:"absolute",display:"block",width:i.width(),height:i.height(),"background-image":"url("+h+")"});if(f.self.browser.ail){f.self.alphaImage(g);g.css("background-image","none")}g.css("opacity",0);if(this.tagName.toLowerCase()==="img"){g.insertBefore(i)}else{i.append(g)}g.data("origin",i);g.hover(f.blend,f.blend)};f.blend=function(i){var k,j,g,h;k=b(this);if(k.data("origin").hasClass(f.opt.ignoreClass)){return}j=i.type==="mouseenter";g=j?1:0;h=f.opt["duration"+(j?"Enter":"Leave")];b(this).stop().fadeTo(h,g)};e.each(function(){if(f.self._hasSize(this)){f.init.call(this)}else{b(this).on("load",f.init)}});return e}}).init();b.fn.extend({alphaImage:function(d){a.alphaImage(this,d);return this},swapImage:function(d){a.swapImage(this,d);return this},blendImage:function(d){a.blendImage(this,d);return this}})}(jQuery));